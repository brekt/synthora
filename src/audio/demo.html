<!DOCTYPE html>
<head>
<script src='./wabetable.js'></script>
<script>
function start() {
    const Audio = window.AudioContext || window.webkitAudioContext;
    const audioCtx = new AudioContext();
    const wave = audioCtx.createPeriodicWave(wavetable.real, wavetable.imag);

    let attackTime = 0.2;
    const attackControl = document.querySelector('#attack');
    attackControl.addEventListener('input', function() {
        attackTime = Number(this.value);
    }, false);

    let releaseTime = 0.5;
    const releaseControl = document.querySelector('#release');
    releaseControl.addEventListener('input', function() {
        releaseTime = Number(this.value);
    }, false);

    let sweepLength = 2;
    function playSweep() {
        let osc = audioCtx.createOscillator();
        osc.setPeriodicWave(wave);
        osc.frequency.value = 440;

        let sweepEnv = audioCtx.createGain();
        sweepEnv.gain.cancelScheduledValues(audioCtx.currentTime);
        sweepEnv.gain.setValueAtTime(0, audioCtx.currentTime);
        // set our attack
        sweepEnv.gain.linearRampToValueAtTime(1, audioCtx.currentTime + attackTime);
        // set our release
        sweepEnv.gain.linearRampToValueAtTime(0, audioCtx.currentTime + sweepLength - releaseTime);

        osc.connect(sweepEnv).connect(audioCtx.destination);
        osc.start();
        osc.stop(audioCtx.currentTime + sweepLength);
    }

    let pulseHz = 880;
    const hzControl = document.querySelector('#hz');
    hzControl.addEventListener('input', function() {
        pulseHz = Number(this.value);
    }, false);

    let lfoHz = 30;
    const lfoControl = document.querySelector('#lfo');
    lfoControl.addEventListener('input', function() {
        lfoHz = Number(this.value);
    }, false);

    let pulseTime = 1;
    function playPulse() {
        let osc = audioCtx.createOscillator();
        osc.type = 'sine';
        osc.frequency.setValueAtTime(pulseHz, audioCtx.currentTime);

        let amp = audioCtx.createGain();
        amp.gain.setValueAtTime(1, audioCtx.currentTime);

        let lfo = audioCtx.createOscillator();
        lfo.type = 'square';
        lfo.frequency.setValueAtTime(lfoHz, audioCtx.currentTime);

        lfo.connect(amp.gain);
        osc.connect(amp).connect(audioCtx.destination);
        lfo.start();
        osc.start();
        osc.stop(audioCtx.currentTime + pulseTime);
    }

    playSweep();
}
</script>
</head>
<body>
    <label for="attack">Attack</label>
    <input name="attack" id="attack" type="range" min="0" max="1" value="0.2" step="0.1" />
    
    <label for="release">Release</label>
    <input name="release" id="release" type="range" min="0" max="1" value="0.5" step="0.1" />

    <label for="hz">Hz</label>
    <input name="hz" id="hz" type="range" min="660" max="1320" value="880" step="1" />

    <label for="lfo">LFO</label>
    <input name="lfo" id="lfo" type="range" min="20" max="40" value="30" step="1" />

    <div>
        <button id='start'>
            START
        </button>
    </div>
</body>
<script>
    const startButton = document.querySelector('#start');

    startButton.addEventListener('click', start);
</script>
</html>
